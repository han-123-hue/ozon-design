<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Master Design</title>
    <style>
        :root { --ozon-blue: #005bff; --dark-bg: #121212; }
        body { font-family: -apple-system, sans-serif; margin: 0; background: var(--dark-bg); color: white; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .app-bar { background: #1e1e1e; padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #333; }
        .canvas-area { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        #capture-box { width: 320px; height: 320px; background: white; border-radius: 12px; overflow: hidden; position: relative; }
        #bg-tpl { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        #user-img { position: absolute; width: 150px; top: 50px; left: 80px; touch-action: none; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.4)); display: none; }
        .tpl-scroll { height: 90px; background: #1e1e1e; display: flex; align-items: center; overflow-x: auto; padding: 0 15px; gap: 12px; }
        .tpl-item { width: 60px; height: 60px; border-radius: 8px; flex-shrink: 0; border: 2px solid transparent; overflow: hidden; opacity: 0.6; }
        .tpl-item.active { border-color: var(--ozon-blue); opacity: 1; transform: scale(1.1); }
        .tpl-item img { width: 100%; height: 100%; object-fit: cover; }
        .panel { background: #1e1e1e; padding: 20px; border-top: 1px solid #333; }
        .btn-up { background: var(--ozon-blue); color: white; padding: 16px; border-radius: 12px; text-align: center; font-weight: bold; position: relative; cursor: pointer; }
        #loading { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>
<div class="app-bar">üé® AI –¶–ï–ù–¢–† –ü–ï–†–°–û–ù–ê–õ–ò–ó–ê–¶–ò–ò</div>
<div class="canvas-area"><div id="capture-box"><img id="bg-tpl" src="https://img.alicdn.com/imgextra/i4/2210667046465/O1CN01Zp1X1X1X1X1X1X1X1X_!!2210667046465.jpg"><img id="user-img"></div></div>
<div class="tpl-scroll">
    <div class="tpl-item active" onclick="changeBg('https://img.alicdn.com/imgextra/i4/2210667046465/O1CN01Zp1X1X1X1X1X1X1X1X_!!2210667046465.jpg', this)"><img src="https://img.alicdn.com/imgextra/i4/2210667046465/O1CN01Zp1X1X1X1X1X1X1X1X_!!2210667046465.jpg"></div>
    <div class="tpl-item" onclick="changeBg('https://img.alicdn.com/imgextra/i2/2210667046465/O1CN016pXv1r1X1X1X1X1X1X_!!2210667046465.jpg', this)"><img src="https://img.alicdn.com/imgextra/i2/2210667046465/O1CN016pXv1r1X1X1X1X1X1X_!!2210667046465.jpg"></div>
</div>
<div class="panel"><div class="btn-up">üì∏ –ó–ê–ì–†–£–ó–ò–¢–¨ –§–û–¢–û (‰∏ä‰º†ÁÖßÁâá)<input type="file" id="up-file" accept="image/*" style="position:absolute; inset:0; opacity:0;"></div></div>
<div id="loading">üöÄ AI –û–ë–†–ê–ë–û–¢–ö–ê...</div>
<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
<script>
    // ‚¨áÔ∏è ÊÅ©‰∫∫ÔºåËøôÈáåÂ°´‰Ω†‰ªé Remove.bg ÊãøÂà∞ÁöÑÂØÜÈí•ÔºÅ
    const API_KEY = 'd12kqQkrNx9hZgF6ZRU8MSmA'; 

    function changeBg(url, el) {
        document.getElementById('bg-tpl').src = url;
        document.querySelectorAll('.tpl-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
    }

    document.getElementById('up-file').onchange = async (e) => {
        const file = e.target.files[0];
        if(!file) return;
        document.getElementById('loading').style.display = 'flex';
        const fd = new FormData();
        fd.append('image_file', file);
        try {
            const res = await fetch('https://api.remove.bg/v1.0/removebg', {
                method: 'POST',
                headers: {'X-Api-Key': API_KEY},
                body: fd
            });
            if(res.ok) {
                const blob = await res.blob();
                const img = document.getElementById('user-img');
                img.src = URL.createObjectURL(blob);
                img.style.display = 'block';
            } else { alert('–û—à–∏–±–∫–∞ AI: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á (ÂØÜÈí•ÈîôËØØÊàñÁî®Â∞Ω)'); }
        } finally { document.getElementById('loading').style.display = 'none'; }
    };

    let angle = 0, scale = 1;
    interact('#user-img').gesturable({
        onmove: (ev) => {
            scale *= (1 + ev.ds);
            angle += ev.da;
            ev.target.style.transform = `scale(${scale}) rotate(${angle}deg)`;
        }
    }).draggable({
        onmove: (ev) => {
            const x = (parseFloat(ev.target.dataset.x) || 0) + ev.dx;
            const y = (parseFloat(ev.target.dataset.y) || 0) + ev.dy;
            ev.target.style.left = `${80 + x}px`;
            ev.target.style.top = `${50 + y}px`;
            ev.target.dataset.x = x;
            ev.target.dataset.y = y;
        }
    });
</script>
</body>
</html>
