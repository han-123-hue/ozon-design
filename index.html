<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Master Design</title>
    <style>
        :root { --ozon-blue: #005bff; --ozon-pink: #f91155; }
        body { font-family: -apple-system, sans-serif; margin: 0; background: #f4f6f9; display: flex; flex-direction: column; align-items: center; overflow: hidden; height: 100vh; }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .nav { width: 100%; background: var(--ozon-blue); color: white; text-align: center; padding: 15px 0; font-weight: bold; font-size: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }

        /* ç”»å¸ƒåŒºåŸŸ */
        #capture-area { width: 340px; height: 340px; margin: 20px auto; background: white; border-radius: 20px; position: relative; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.15); border: 4px solid white; touch-action: none; }
        #bg-template { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        #user-face { position: absolute; top: 80px; left: 100px; width: 120px; cursor: move; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3)); touch-action: none; display: none; }

        /* æ¨¡æ¿é€‰æ‹©å™¨ */
        .scroll-box { width: 100%; padding: 10px 0; display: flex; overflow-x: auto; white-space: nowrap; gap: 15px; padding-left: 20px; }
        .template-item { width: 70px; height: 70px; border-radius: 12px; border: 3px solid transparent; flex-shrink: 0; object-fit: cover; }
        .template-item.active { border-color: var(--ozon-blue); transform: scale(1.05); }

        /* æ§åˆ¶åŒº */
        .controls { width: 90%; background: white; border-radius: 25px; padding: 20px; margin-top: auto; margin-bottom: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 12px; }
        .btn-main { background: var(--ozon-blue); color: white; padding: 16px; border-radius: 15px; text-align: center; font-weight: bold; position: relative; cursor: pointer; }
        .btn-order { display: none; background: var(--ozon-pink); color: white; padding: 16px; border-radius: 15px; text-align: center; font-weight: bold; text-decoration: none; animation: pulse 2s infinite; }
        
        #loading { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999; color: white; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 30px; height: 30px; border: 3px solid #fff; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="nav">ğŸ¨ AI ĞšĞ Ğ•ĞĞ¢Ğ˜Ğ’-Ğ¦Ğ•ĞĞ¢Ğ </div>

<div id="capture-area">
    <img id="bg-template" src="https://img.alicdn.com/imgextra/i4/2210667046465/O1CN01Zp1X1X1X1X1X1X1X1X_!!2210667046465.jpg">
    <img id="user-face" src="">
</div>

<div class="scroll-box">
    <img class="template-item active" src="https://img.alicdn.com/imgextra/i4/2210667046465/O1CN01Zp1X1X1X1X1X1X1X1X_!!2210667046465.jpg" onclick="changeBg(this.src, this)">
    <img class="template-item" src="https://img.alicdn.com/imgextra/i2/2210667046465/O1CN016pXv1r1X1X1X1X1X1X_!!2210667046465.jpg" onclick="changeBg(this.src, this)">
    <img class="template-item" src="https://img.alicdn.com/imgextra/i3/2210667046465/O1CN01pXv1r1X1X1X1X1X1X1X_!!2210667046465.jpg" onclick="changeBg(this.src, this)">
</div>

<div class="controls">
    <div class="btn-main">
        ğŸ“¸ Ğ—ĞĞ“Ğ Ğ£Ğ—Ğ˜Ğ¢Ğ¬ Ğ¤ĞĞ¢Ğ (ä¸Šä¼ ç…§ç‰‡)
        <input type="file" id="file-input" accept="image/*" style="position:absolute;left:0;top:0;width:100%;height:100%;opacity:0;">
    </div>
    <a href="https://www.ozon.ru/cart" id="order-link" class="btn-order">ğŸ›’ ĞšĞ£ĞŸĞ˜Ğ¢Ğ¬ Ğ¡Ğ•Ğ™Ğ§ĞĞ¡ (ç«‹å³è´­ä¹°)</a>
    <p style="text-align:center; font-size:11px; color:#999;">Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ´Ğ²Ğ° Ğ¿Ğ°Ğ»ÑŒÑ†Ğ° Ğ´Ğ»Ñ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ<br>(åŒæŒ‡ç¼©æ”¾å’Œæ—‹è½¬ç…§ç‰‡)</p>
</div>

<div id="loading"><div class="spinner"></div><span>AI ĞĞ‘Ğ ĞĞ‘ĞĞ¢ĞšĞ...</span></div>

<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

<script>
    const API_KEY = 'YOUR_API_KEY_HERE'; // â¬…ï¸ æ©äººï¼Œè¿™é‡Œè¿˜æ˜¯å¾—å¡« Remove.bg çš„ Key
    const face = document.getElementById('user-face');
    const loading = document.getElementById('loading');

    // 1. åˆ‡æ¢æ¨¡æ¿åŠŸèƒ½
    function changeBg(url, el) {
        document.getElementById('bg-template').src = url;
        document.querySelectorAll('.template-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
    }

    // 2. AI æŠ å›¾åŠŸèƒ½
    document.getElementById('file-input').onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        loading.style.display = 'flex';

        const formData = new FormData();
        formData.append('image_file', file);
        formData.append('size', 'auto');

        try {
            const res = await fetch('https://api.remove.bg/v1.0/removebg', {
                method: 'POST',
                headers: { 'X-Api-Key': API_KEY },
                body: formData
            });
            if (res.ok) {
                const blob = await res.blob();
                face.src = URL.createObjectURL(blob);
                face.style.display = 'block';
                document.getElementById('order-link').style.display = 'block';
            }
        } finally {
            loading.style.display = 'none';
        }
    };

    // 3. ç¥çº§åŠŸèƒ½ï¼šåŒæŒ‡ç¼©æ”¾ã€æ—‹è½¬ã€ç§»åŠ¨
    let angle = 0, scale = 1;
    interact('#user-face').gesturable({
        onmove: (event) => {
            scale = scale * (1 + event.ds);
            angle += event.da;
            face.style.transform = `scale(${scale}) rotate(${angle}deg)`;
        }
    }).draggable({
        onmove: (event) => {
            const x = (parseFloat(face.getAttribute('data-x')) || 0) + event.dx;
            const y = (parseFloat(face.getAttribute('data-y')) || 0) + event.dy;
            face.style.left = `${100 + x}px`;
            face.style.top = `${80 + y}px`;
            face.setAttribute('data-x', x);
            face.setAttribute('data-y', y);
        }
    });
</script>
</body>
</html>
