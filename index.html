<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Magnet Designer Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <style>
        :root { --primary-color: #005bff; --bg-dark: #121212; --panel-bg: #1e1e1e; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; background: var(--bg-dark); color: #fff;
            height: 100vh; display: flex; flex-direction: column; overflow: hidden; /* é”å®šæ»šåŠ¨ */
        }

        /* --- 1. éªŒè¯é—¨ --- */
        #gate-overlay {
            position: fixed; inset: 0; background: var(--bg-dark); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px;
        }
        .gate-box { background: var(--panel-bg); padding: 30px; border-radius: 20px; text-align: center; width: 80%; max-width: 300px; }
        .gate-input {
            width: 100%; padding: 12px; margin: 20px 0; border-radius: 10px;
            border: 1px solid #333; background: #000; color: #fff; text-align: center; font-size: 16px;
        }
        .btn-main {
            background: var(--primary-color); color: #fff; padding: 14px; border-radius: 12px;
            font-weight: bold; text-align: center; cursor: pointer; display: block; text-decoration: none;
        }

        /* --- 2. ä¸»ç•Œé¢ç»“æ„ --- */
        .header { padding: 15px; text-align: center; font-weight: bold; background: var(--panel-bg); }
        .main-area { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }

        /* æ ¸å¿ƒç”»å¸ƒï¼šä¸‰æ˜æ²»ç»“æ„ */
        .canvas-container {
            width: 320px; height: 320px; position: relative;
            background: #fff; /* åº•å±‚èƒŒæ™¯è‰² */
            border-radius: 12px; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        /* ä¸­å±‚ï¼šç”¨æˆ·ç…§ç‰‡ (å¯æ“ä½œ) */
        #user-photo-layer {
            position: absolute; top: 50%; left: 50%; width: 150px;
            transform: translate(-50%, -50%); /* åˆå§‹å±…ä¸­ */
            touch-action: none; z-index: 5; /* å±‚çº§ä¸­ç­‰ */
            display: none; /* é»˜è®¤éšè— */
        }
        /* ä¸Šå±‚ï¼šå‰æ™¯æ¨¡ç‰ˆ (æŒ¡åœ¨ä¸Šé¢ï¼Œä¸å¯æ“ä½œ) */
        #foreground-template-layer {
            position: absolute; inset: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: 10; /* å±‚çº§æœ€é«˜ */
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€ä¸‹å» */
        }

        /* --- 3. åº•éƒ¨æ§ä»¶ --- */
        .controls-panel { background: var(--panel-bg); padding-bottom: 20px; border-top-left-radius: 20px; border-top-right-radius: 20px; }
        /* æ¨¡ç‰ˆæ»‘åŠ¨æ¡ */
        .template-scroll {
            display: flex; gap: 10px; padding: 15px; overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* iOSæµç•…æ»šåŠ¨ */
        }
        .tpl-thumb {
            width: 60px; height: 60px; flex-shrink: 0; border-radius: 10px; overflow: hidden;
            border: 2px solid transparent; transition: all 0.2s; opacity: 0.5;
        }
        .tpl-thumb.active { border-color: var(--primary-color); opacity: 1; transform: scale(1.05); }
        .tpl-thumb img { width: 100%; height: 100%; object-fit: cover; }
        
        /* æŒ‰é’®åŒº */
        .actions-area { padding: 0 20px; display: flex; flex-direction: column; gap: 10px; }
        .tips { text-align: center; font-size: 12px; color: #888; margin-top: 5px; }

        /* åŠ è½½åŠ¨ç”» */
        #loading { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; color: var(--primary-color); font-weight: bold;}
    </style>
</head>
<body>

    <div id="gate-overlay">
        <div class="gate-box">
            <h3>ğŸ” Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ´<br>(è¾“å…¥æš—å·)</h3>
            <input type="text" id="gate-code" class="gate-input" placeholder="ĞšĞ¾Ğ´ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°">
            <div class="btn-main" onclick="checkCode()">Ğ’ĞĞ™Ğ¢Ğ˜ (è¿›å…¥)</div>
            <p style="font-size:11px; color:#666; margin-top:15px;">Ğ¡Ğ²ÑĞ¶Ğ¸Ñ‚ĞµÑÑŒ Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ñ†Ğ¾Ğ¼ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ°</p>
        </div>
    </div>

    <div class="header">ğŸ¨ AI Ğ”Ğ¸Ğ·Ğ°Ğ¹Ğ½-ÑÑ‚ÑƒĞ´Ğ¸Ñ</div>

    <div class="main-area">
        <div class="canvas-container">
            <img id="user-photo-layer">
            <img id="foreground-template-layer" src="https://img.alicdn.com/imgextra/i4/2210667046465/O1CN01Zp1X1X1X1X1X1X1X1X_!!2210667046465.jpg">
        </div>
    </div>

    <div class="controls-panel">
        <div class="template-scroll">
             <div class="tpl-thumb active" onclick="changeTemplate('https://img.alicdn.com/imgextra/i4/2210667046465/O1CN01Zp1X1X1X1X1X1X1X1X_!!2210667046465.jpg', this)">
                <img src="https://img.alicdn.com/imgextra/i4/2210667046465/O1CN01Zp1X1X1X1X1X1X1X1X_!!2210667046465.jpg">
            </div>
            <div class="tpl-thumb" onclick="changeTemplate('https://img.alicdn.com/imgextra/i2/2210667046465/O1CN016pXv1r1X1X1X1X1X1X_!!2210667046465.jpg', this)">
                <img src="https://img.alicdn.com/imgextra/i2/2210667046465/O1CN016pXv1r1X1X1X1X1X1X_!!2210667046465.jpg">
            </div>
             <div class="tpl-thumb" onclick="changeTemplate('https://img.alicdn.com/imgextra/i3/2210667046465/O1CN01pXv1r1X1X1X1X1X1X1X_!!2210667046465.jpg', this)">
                <img src="https://img.alicdn.com/imgextra/i3/2210667046465/O1CN01pXv1r1X1X1X1X1X1X1X_!!2210667046465.jpg">
            </div>
        </div>

        <div class="actions-area">
            <label class="btn-main">
                ğŸ“¸ Ğ—ĞĞ“Ğ Ğ£Ğ—Ğ˜Ğ¢Ğ¬ Ğ¤ĞĞ¢Ğ (ä¸Šä¼ ç…§ç‰‡)
                <input type="file" id="upload-input" accept="image/*" style="display:none;">
            </label>
            <div class="tips">Ğ”Ğ²Ğ¸Ğ³Ğ°Ğ¹Ñ‚Ğµ Ğ¸ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ´Ğ²ÑƒĞ¼Ñ Ğ¿Ğ°Ğ»ÑŒÑ†Ğ°Ğ¼Ğ¸<br>(åŒæŒ‡æåˆç¼©æ”¾/æ—‹è½¬ï¼Œå¯¹å‡†æ¨¡ç‰ˆ)</div>
            <div class="btn-main" style="background:#f91155; margin-top:5px;" onclick="alert('ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑĞ´ĞµĞ»Ğ°Ğ¹Ñ‚Ğµ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚ Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ Ğ½Ğ°Ğ¼ Ğ² Ñ‡Ğ°Ñ‚! \n(è¯·æˆªå›¾å¹¶å‘é€ç»™å®¢æœ!)')">âœ… Ğ“ĞĞ¢ĞĞ’Ğ (å®Œæˆè®¾è®¡ - æˆªå›¾)</div>
        </div>
    </div>

    <div id="loading">ğŸš€ AI ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°...</div>

    <script>
        // =============== é…ç½®åŒº ===============
        const API_KEY = 'd12kqQkrNx9hZgF6ZRU8MSmA'; // â¬…ï¸ å¿…é¡»å¡«ï¼
        const ACCESS_CODE = '8888'; // â¬…ï¸ è®¾ç½®ä½ çš„è¿›å…¥æš—å·
        // =====================================


        // 1. éªŒè¯é—¨é€»è¾‘
        function checkCode() {
            const input = document.getElementById('gate-code').value;
            if (input === ACCESS_CODE) {
                document.getElementById('gate-overlay').style.display = 'none';
            } else {
                alert('ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ (æš—å·é”™è¯¯)');
            }
        }

        // 2. åˆ‡æ¢æ¨¡ç‰ˆé€»è¾‘
        function changeTemplate(url, el) {
            document.getElementById('foreground-template-layer').src = url;
            document.querySelectorAll('.tpl-thumb').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        // 3. AI æŠ å›¾é€»è¾‘
        const userPhotoLayer = document.getElementById('user-photo-layer');
        document.getElementById('upload-input').onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            document.getElementById('loading').style.display = 'flex';
            const fd = new FormData();
            fd.append('image_file', file);
            try {
                const res = await fetch('https://api.remove.bg/v1.0/removebg', {
                    method: 'POST', headers: { 'X-Api-Key': API_KEY }, body: fd
                });
                if (res.ok) {
                    const blob = await res.blob();
                    userPhotoLayer.src = URL.createObjectURL(blob);
                    userPhotoLayer.style.display = 'block';
                    // é‡ç½®ä½ç½®å’Œç¼©æ”¾
                    scale = 1; angle = 0; x = 0; y = 0;
                    updateTransform();
                } else { alert('AI Error: Check Key'); }
            } catch (err) { alert('Network Error'); } 
            finally { document.getElementById('loading').style.display = 'none'; }
        };

        // 4. ä¸“ä¸šçº§æ‰‹åŠ¿æ“æ§ (æ ¸å¿ƒä½“éªŒ)
        let scale = 1, angle = 0, x = 0, y = 0;
        function updateTransform() {
            // å…³é”®ï¼šåŒæ—¶åº”ç”¨ä½ç§»ã€æ—‹è½¬å’Œç¼©æ”¾
            userPhotoLayer.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px)) rotate(${angle}deg) scale(${scale})`;
        }

        interact('#user-photo-layer').gesturable({
            onmove: (ev) => {
                scale *= (1 + ev.ds);
                angle += ev.da;
                updateTransform();
            }
        }).draggable({
            onmove: (ev) => {
                x += ev.dx;
                y += ev.dy;
                updateTransform();
            }
        });
    </script>
</body>
</html>
